name: Build Veg ZIP

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show workspace info (debug)
        run: |
          pwd
          ls -la
          echo "---- images tree ----"
          ls -R images || true
          echo "git list:"
          git ls-tree -r --name-only HEAD | head -n 50

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Run ZIP creation script
        run: python veg_zip_create.py

      - name: Verify ZIP size (debug, fail if empty)
        run: |
          ls -lh Veg_Fruit_Leafy_Marathi.zip
          BYTES=$(stat -c%s "Veg_Fruit_Leafy_Marathi.zip")
          echo "ZIP size: $BYTES bytes"
          if [ "$BYTES" -lt 2000 ]; then
            echo "ZIP too small. Likely no files added." >&2
            exit 1
          fi

      - name: Upload ZIP as artifact
        uses: actions/upload-artifact@v4
        with:
          name: Veg_Fruit_Leafy_Marathi
          path: Veg_Fruit_Leafy_Marathi.zip
